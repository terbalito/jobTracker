<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobTracker Pro | Gestionnaire d'Opportunités</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
</head>
<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

        // Config Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCctInHQCrbOjJM_KRzJAOVcnNsSF-d3sc",
            authDomain: "jobtracker-1e97f.firebaseapp.com",
            projectId: "jobtracker-1e97f",
            storageBucket: "jobtracker-1e97f.firebasestorage.app",
            messagingSenderId: "1052589010482",
            appId: "1:1052589010482:web:99a79df3c396fca97b562b",
            measurementId: "G-D8KG274ZSL"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // On expose auth et firestore globalement pour app.js / auth.js
        window.auth = auth;
        window.db = db;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
    </script>

    <div id="loading-screen" class="loading-screen">
        <div class="skeleton">

            <!-- Stats -->
            <div class="skeleton-header">
                <div class="skeleton-stat"></div>
                <div class="skeleton-stat"></div>
                <div class="skeleton-stat"></div>
                <div class="skeleton-stat"></div>
                <div class="skeleton-stat"></div>
            </div>

            <!-- Cards -->
            <div class="skeleton-grid">
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
            </div>

        </div>
    </div>


    <div class="auth-wrapper">
        <section id="auth-screen">
            <h2 id="auth-title">Se connecter</h2>

            <input id="username" placeholder="Adresse mail">
            <input id="password" type="password" placeholder="Mot de passe">
            <input id="password-confirm" type="password" placeholder="Confirmer le mot de passe" class="hidden">
            <button id="login-btn">Se connecter</button>
            <button id="signup-btn" class="hidden">Créer un compte</button>

            <p id="auth-error"></p>

            <span id="switch-auth">Pas encore de compte ? S'inscrire</span>
        </section>
    </div>

    <div class="app-container">
        <!-- Dashboard Stats -->
        <header class="dashboard">
            <div class="stat-card" id="stat-total">
                <span class="stat-value">0</span>
                <span class="stat-label">Total</span>
            </div>
            <div class="stat-card" id="stat-postulated">
                <span class="stat-value">0</span>
                <span class="stat-label">Postulées</span>
            </div>
            <div class="stat-card" id="stat-pending">
                <span class="stat-value">0</span>
                <span class="stat-label">À faire</span>
            </div>
            <div class="stat-card urgent" id="stat-urgent">
                <span class="stat-value">0</span>
                <span class="stat-label">Urgentes</span>
            </div>
            <div class="stat-card expired" id="stat-expired">
                <span class="stat-value">0</span>
                <span class="stat-label">Expirées</span>
            </div>
        </header>

        <main class="content">
            <!-- Formulaire d'ajout -->
            <section class="add-offer-section">
                <button id="toggle-form-btn" class="btn-primary">
                    <span class="icon">+</span> Ajouter une offre
                </button>
                
                <form id="job-form" class="hidden">
                    <div class="form-grid">
                        <input type="text" id="job-title" placeholder="Titre du poste (ex: Développeur Front-end)" required>
                        <input type="text" id="job-company" placeholder="Entreprise (ex: TechCorp)" required>
                        <input type="url" id="job-link" placeholder="Lien de l'offre (https://...)" required>
                        <div class="date-input">
                            <label for="job-deadline">Date limite :</label>
                            <input type="date" id="job-deadline" required>
                        </div>
                        <textarea id="job-desc" placeholder="Description ou notes rapides..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-submit">Valider l'offre</button>
                        <button type="button" id="cancel-form" class="btn-secondary">Annuler</button>
                    </div>
                </form>
            </section>

            <!-- Filtres -->
            <nav class="filters">
                <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-list"></i> Toutes
                </button>
                <button class="filter-btn" data-filter="urgent">
                    <i class="fas fa-bolt"></i> Urgentes
                </button>
                <button class="filter-btn" data-filter="postulated">
                    <i class="fas fa-check-circle"></i> Postulées
                </button>
                <button class="filter-btn" data-filter="expired">
                    <i class="fas fa-clock"></i> Expirées
                </button>
            </nav>


            <!-- Liste des offres -->
            <div id="offers-list" class="offers-grid">
                <!-- Les cartes seront injectées ici -->
            </div>

            <!-- Message si vide -->
            <div id="empty-state" class="hidden">
                <p>Aucune offre ici. Profitez-en pour vous détendre ! ☕</p>
            </div>
        </main>
    </div>

    <!-- Notification system -->
    <div id="notification-toast" class="toast hidden"></div>

    <audio id="snd-success" src="success.mp3"></audio>
    <audio id="snd-alert" src="alert.mp3"></audio>

        <!-- Firebase SDK -->
        <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCctInHQCrbOjJM_KRzJAOVcnNsSF-d3sc",
            authDomain: "jobtracker-1e97f.firebaseapp.com",
            projectId: "jobtracker-1e97f",
            storageBucket: "jobtracker-1e97f.firebasestorage.app",
            messagingSenderId: "1052589010482",
            appId: "1:1052589010482:web:99a79df3c396fca97b562b",
            measurementId: "G-D8KG274ZSL"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.auth = auth;
        window.db = db;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        </script>

        <!-- Auth -->
        <script type="module" src="js/auth.js"></script>

        <!-- DataManager -->
        <script type="module" src="js/data.js"></script>

        <!-- App principal -->
        <script type="module" src="js/app.js"></script>

</body>
</html>